<!DOCTYPE html>
<html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init">
<head>
  <meta charset="utf-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <link rel="icon" href="/favicon.ico">
  
  <title>萤火虫的博客 | SpringBoot开发案例之整合Spring-data-jpa</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox-1.3.4.css">
  <!--在这里倒入jquery 方便处理部分页面的jquery-->
  <script src="https://cdn.staticfile.org/jquery/1.7/jquery.min.js" type="text/javascript" ></script>
</head>

<body>
	<div style="width:500px;height:20px;text-align:center;border:1px solid #fff;margin-left:1000px">
  <a style="margin-top:10px;color:#fff;text-decoration:none;" href="http://springboot.javaboy.org/" target="_blank" rel="noopener">Spring Boot</a>&nbsp;&nbsp;&nbsp;
  <a style="margin-top:10px;color:#fff;text-decoration:none;" href="http://www.ityouknow.com/link.html" target="_blank" rel="noopener">架构师</a>&nbsp;&nbsp;&nbsp;
  <a style="margin-top:10px;color:#fff;text-decoration:none;" href="http://mybatis.javaboy.org/" target="_blank" rel="noopener">MyBatis</a>&nbsp;&nbsp;&nbsp;
  <a style="margin-top:10px;color:#fff;text-decoration:none;" href="http://www.ityouknow.com/cartoon.html" target="_blank" rel="noopener">漫画</a>&nbsp;&nbsp;&nbsp;
  <a style="margin-top:10px;color:#fff;text-decoration:none;" href="http://springmvc.javaboy.org/" target="_blank" rel="noopener">SpringMVC</a>&nbsp;&nbsp;&nbsp;
  <a style="margin-top:10px;color:#fff;text-decoration:none;" href="http://spring.javaboy.org/" target="_blank" rel="noopener">Spring</a>
  
 
</div>
<header class="site-header">
  <div class="container">
      <h1><a href="/" title="萤火虫的博客"><span class="octicon octicon-flame"></span> 萤火虫的博客</a></h1>
      <nav class="site-header-nav" role="navigation">
        
              
              <a href="/"  class=" site-header-nav-item hvr-underline-from-center" title="Home">Home</a>
        
              
              <a href="/categories/"  class=" site-header-nav-item hvr-underline-from-center" title="Archives">Archives</a>
        
              
              <a href="/open-source/"  class=" site-header-nav-item hvr-underline-from-center" title="仓库">仓库</a>
        
              
              <a href="/about/"  class=" site-header-nav-item hvr-underline-from-center" title="About">About</a>
        
      </nav>
  </div>
</header>

	
<section class="collection-head geopattern" data-pattern-id="SpringBoot开发案例之整合Spring-data-jpa" >
    <div class="container">
        <div class="collection-title">
            <h1 class="collection-header">
                SpringBoot开发案例之整合Spring-data-jpa
            </h1>
			<span class="mega-octicon octicon-clippy"> <font size="5px" color="blue">专题系列:</font> <a href="http://www.ityouknow.com/docker.html" target="_blank" rel="noopener"><font color="#1E90FF" size="5px">Docker  </font></a>,<a href="http://www.ityouknow.com/spring-cloud.html" target="_blank" rel="noopener"><font color="yellow" size="5px">  SpringCloud</font></a></span>
			<div style="height:15px"></div>
			<span class="mega-octicon octicon-cloud-download"> <font size="5px">csdn地址:<a href="https://blog.csdn.net/weixin_42100064/article/list/1?" target="_blank" rel="noopener"><font color="#00FF00" size="4px"> 三十三行伪代码</font></a> 欢迎大家交流支持！</font></span>
			<div style="height:15px"></div>
            
                <div class="collection-info">
                    <span class="meta-info">
                        <span class="octicon octicon-calendar"></span>&nbsp;
                        <time datetime="2019-11-07T07:28:42.000Z" itemprop="datePublished">2019-11-07</time>
                    </span>
                    
                        <span class="meta-info">
                            <span class="octicon octicon-file-directory"></span>
                            <a href='/categories/SpringBoot系列/' title=''>SpringBoot系列</a>
                        </span>
                    
                </div>
            
        </div>
    </div>
</section>
	<section class="container">
    <div class="columns">
        <div class="column  three-fourths " >
            <article class="article-content markdown-body">
                <blockquote>
<p>即使你是天才，如果你不努力，你也会被其它人超越。</p>
</blockquote>
<a id="more"></a>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9ibG9nLjUyaXRzdHlsZS52aXAvdXNyL3VwbG9hZHMvMjAxNy8wNy8xMjQ4NTc0MzguanBn?x-oss-process=image/format,png#pic_center" alt=""></p>
<h3 id="扯淡-我们是认真的"><a href="#扯淡-我们是认真的" class="headerlink" title="扯淡!我们是认真的"></a>扯淡!我们是认真的</h3><p>  扯了那么多篇SpringBoot的相关案例，基本每行代码都是博主纯手工编写，附代码案例，懂Maven和Git的小伙伴必须可以手到擒来。<br>SpringBoot使得开发变的更加简洁，快速，当然被封装的越来越深。此时你就要引入越来越多的第三方工具类，虽然你可以把搭建好的项目运行起来，却无法理解是怎么跑起来的。有些人带着疑惑查阅文档，阅读源码，多年以后便成了大牛；有些人不求甚解，能跑就行，就这样干了N年CURD。<br>俗话说的好，燕雀安知鸿鹄之志哉？然子非鱼又焉知鱼之乐？curd并快乐着。每个人，都会有自己的成长轨迹，或平凡或精彩或或或或，快使用双节棍，嘿嘿哈嘿。</p>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>好了，淡就扯这么多，今天与大家分享一款”超薄”的数据访问层框架Spring-data-jpa，依赖Hibernate，对Hibernate有一定的基础，可以更好的理解。</p>
<h3 id="什么是spring-data"><a href="#什么是spring-data" class="headerlink" title="什么是spring-data"></a>什么是spring-data</h3><p>为了简化程序与数据库交互的代码，spring提供了一个现成的dao层框架，spring家族提供的spring-data适用于关系型数据库和nosql数据库。比如之前我们讲解的案例：<br>SpringBoot开发案例之整合mongoDB，当然还有Spring Data Solr，Spring Data Redis以及我们今天要分享的Spring Data JPA。</p>
<p>详解的可以参考:<img src="https://spring.io/projects/spring-data" alt="官网"></p>
<h3 id="什么是JPA"><a href="#什么是JPA" class="headerlink" title="什么是JPA"></a>什么是JPA</h3><p>JPA全称为Java持久性API（Java Persistence API），JPA是java EE 5标准之一，是一个ORM规范，由厂商来实现该规范，目前有hibernate、OpenJPA、TopLink、EclipseJPA等实现。</p>
<h3 id="如何使用JPA"><a href="#如何使用JPA" class="headerlink" title="如何使用JPA"></a>如何使用JPA</h3><p><strong>查询</strong></p>
<p>1.查询所有数据 findAll()<br>2.分页查询 findAll(new PageRequest(0, 2))<br>3.根据id查询 findOne()<br>4.根据实体类属性查询： findByProperty (type Property); 例如：findByAge(int age);<br>5.排序： findAll(sort )<br>6.Sort sort = new Sort(Sort.Direction.DESC, “age”).and (new Sort(Sort.Direction.DESC, “id”));<br>7.条件查询 and/or/findByAgeLessThan/LessThanEqual 等，<br>例如： findByUsernameAndPassword(String username , String password)<br>8.总数 查询 count() 或者 根据某个属性的值查询总数countByAge(int age);<br>9.是否存在某个id exists()<br>10.修改，删除，新增</p>
<p>1.新增：直接使用 save(T) 方法<br>2.删除： delete() 或者 deleteByProperty 例如：deleteByAge(int age) ;<br>3.更新：<br>@Modifying<br>@Query(“update Customer u set u.age = ?1 where u.id = ?2”)<br>int update(int age1 , long id);</p>
<h3 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h3><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9ibG9nLjUyaXRzdHlsZS52aXAvdXNyL3VwbG9hZHMvMjAxNy8wNy8yOTI3ODM3NzY4LnBuZw?x-oss-process=image/format,png#pic_center" alt=""></p>
<h3 id="相关配置"><a href="#相关配置" class="headerlink" title="相关配置"></a>相关配置</h3><p><strong>pom.xml(部分代码，详见源码)：</strong></p>
<pre><code>&lt;dependency&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre><p><strong>application.properties：</strong></p>
<pre><code># 项目contextPath
server.context-path=/jpa
# 服务端口
server.port=8080
# session最大超时时间(分钟)，默认为30
server.session-timeout=60
# 该服务绑定IP地址，启动服务器时如本机不是该IP地址则抛出异常启动失败，只有特殊需求的情况下才配置
#server.address=192.168.1.66

# tomcat最大线程数，默认为200
server.tomcat.max-threads=100
# tomcat的URI编码
server.tomcat.uri-encoding=UTF-8

#注意中文乱码
spring.datasource.url=jdbc:mysql://localhost:3306/test?characterEncoding=utf-8
spring.datasource.username=root
spring.datasource.password=123
spring.datasource.driver-class-name=com.mysql.jdbc.Driver
# Specify the DBMS
spring.jpa.database = MYSQL
# Show or not log for each sql query
spring.jpa.show-sql = true
# DDL mode. This is actually a shortcut for the &quot;hibernate.hbm2ddl.auto&quot; property. Default to &quot;create-drop&quot; when using an embedded database, &quot;none&quot; otherwise.
spring.jpa.hibernate.ddl-auto = update
# Hibernate 4 naming strategy fully qualified name. Not supported with Hibernate 5.
spring.jpa.hibernate.naming.strategy = org.hibernate.cfg.ImprovedNamingStrategy
# stripped before adding them to the entity manager)
spring.jpa.properties.hibernate.dialect = org.hibernate.dialect.MySQL5Dialect</code></pre><p>spring.jpa.properties.hibernate.hbm2ddl.auto是hibernate的配置属性，其主要作用是：自动创建、更新、验证数据库表结构。该参数的几种配置如下：</p>
<p>1.create：每次加载hibernate时都会删除上一次的生成的表，然后根据你的model类再重新来生成新表，哪怕两次没有任何改变也要这样执行，这就是导致数据库表数据丢失的一个重要原因。<br>2.create-drop：每次加载hibernate时根据model类生成表，但是sessionFactory一关闭,表就自动删除。<br>3.update：最常用的属性，第一次加载hibernate时根据model类会自动建立起表的结构（前提是先建立好数据库），以后加载hibernate时根据model类自动更新表结构，即使表结构改变了但表中的行仍然存在不会删除以前的行。要注意的是当部署到服务器后，表结构是不会被马上建立起来的，是要等应用第一次运行起来后才会。<br>4.validate：每次加载hibernate时，验证创建数据库表结构，只会和数据库中的表进行比较，不会创建新表，但是会插入新值。<br>实体类 User.java:</p>
<pre><code>package com.itstyle.jpa.model;
import java.io.Serializable;
import javax.persistence.*;
/**
 * 用户实体(此处注意引用的注解包为javax.persistence*下面的)
 * 创建者 科帮网
 * 创建时间    2017年7月25日
 *
 */
@Entity
@Table(name = &quot;sys_user&quot;)
public class User implements Serializable{
    private static final long serialVersionUID = 1L;
    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    @Column(name = &quot;id&quot;, nullable = false)
    private Long id;
    @Column(nullable = false, name = &quot;name&quot;)
    private String name;
    @Column(nullable = false, name = &quot;age&quot;)
    private Integer age;
    --- 省略 get set 方法
}</code></pre><p>数据操作UserRepository.java:</p>
<pre><code>/**
 * 数据操作层
 * 创建者 科帮网
 * 创建时间    2017年7月25日
 *
 */
public interface UserRepository extends JpaRepository&lt;User, Long&gt; {

    User findByName(String name);

    User findByAge(Integer age);

    User findByNameAndAge(String name, Integer age);

    List&lt;User&gt; findByNameLike(String name);

    @Query(&quot;from User u where u.name=:name&quot;)
    User findUser(@Param(&quot;name&quot;) String name);

}</code></pre><p>小伙伴没有没有发现，我们只是定义了一个方法而已，怎么就这么奇妙的实现的对应功能？其实这是Spring-data-jpa的新特性，通过解析方法名创建查询。更多解析说明如下：</p>
<p>And =&gt; 等价于 SQL 中的 and 关键字 例如：findByUsernameAndPassword(String user, Striang pwd)；<br>Or =&gt; 等价于 SQL 中的 or 关键字，例如：findByUsernameOrAddress(String user, String addr)；<br>Between =&gt; 等价于 SQL 中的 between 关键字，例如：SalaryBetween(int max, int min)；<br>LessThan =&gt; 等价于 SQL 中的 “&lt;”，例如： findBySalaryLessThan(int max)；<br>GreaterThan =&gt; 等价于 SQL 中的”&gt;”，例如： findBySalaryGreaterThan(int min)；<br>IsNull =&gt; 等价于 SQL 中的 “is null”，例如： findByUsernameIsNull()；<br>IsNotNull =&gt; 等价于 SQL 中的 “is not null”，例如： findByUsernameIsNotNull()；<br>NotNull=&gt; 与 IsNotNull 等价；<br>Like =&gt; 等价于 SQL 中的 “like”，例如： findByUsernameLike(String user)；<br>NotLike =&gt; 等价于 SQL 中的 “not like”，例如： findByUsernameNotLike(String user)；<br>OrderBy =&gt; 等价于 SQL 中的 “order by”，例如： findByUsernameOrderBySalaryAsc(String user)；<br>Not =&gt; 等价于 SQL 中的 “！ =”，例如： findByUsernameNot(String user)；<br>In =&gt; 等价于 SQL 中的 “in”，例如： findByUsernameIn(Collection<String> userList) ，方法的参数可以是 Collection 类型，也可以是数组或者不定长参数；<br>NotIn =&gt; 等价于 SQL 中的 “not in”，例如： findByUsernameNotIn(Collection<String> userList) ，方法的参数可以是 Collection 类型，也可以是数组或者不定长参数；<br>创建一个按单字段排序的Sort对象: new Sort(Sort.Direction.DESC, “description”).and(new Sort(Sort.Direction.ASC, “id”))</p>
<p>最终测试类SpringbootJpaApplication.java:</p>
<pre><code>package com.itstyle.jpa;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

import com.itstyle.jpa.model.User;
import com.itstyle.jpa.repository.UserRepository;

@SpringBootApplication
public class SpringbootJpaApplication implements CommandLineRunner {

    @Autowired
    private UserRepository userRepository;

    public static void main(String[] args) {
        SpringApplication.run(SpringbootJpaApplication.class, args);
    }

    @Override
    public void run(String... args) throws Exception {
        try {
            User user = new User();
            user.setName(&quot;张三&quot;);
            user.setAge(20);
            userRepository.save(user);
            List&lt;User&gt; u = userRepository.findByNameLike(&quot;%张三%&quot;);
            System.out.println(u.size());
            User  us =  userRepository.findByAge(20);
            System.out.println(us.getAge());
            us =  userRepository.findByName(&quot;这是你干&quot;);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}</code></pre><h3 id="偶遇问题"><a href="#偶遇问题" class="headerlink" title="偶遇问题"></a>偶遇问题</h3><p>No identifier specified for entity:</p>
<p>检查一下包是否引入正确，引入一下：</p>
<pre><code>import javax.persistence.*;</code></pre><p>中文乱码问题：</p>
<pre><code>spring.datasource.url=jdbc:mysql://localhost:3306/test?characterEncoding=utf-8</code></pre><p>在高版本mysql中需要指定是否进行SSL连接</p>
<pre><code>spring.datasource.url=jdbc:mysql://localhost:3306/test?characterEncoding=utf-8&amp;useSSL=false</code></pre>
            </article>
            
                <div class="share">
                    <!--开启分享-->
<div class="share-component" data-disabled="google,twitter,facebook" data-description="
即使你是天才，如果你不努力，你也会被其它人超越。
"></div>

<script src="/js/share.min.js"></script>

                </div>    
            

            
            
                
<div class="comments">
    <div id="container"></div>
        <script src="/js/gitment.browser.js"></script>
         <script>
            var gitment = new Gitment({
                id: '/2019/11/07/springboot-jpa/',
                owner: '',
                repo: '',
                oauth: {
                    client_id: "",
                    client_secret: "",
                }
            })
        gitment.render('container')
        </script>
</div>

            

        </div>
        <div class="column one-fourth">
            
                
                


<h3>文章目录</h3>

<div id="post-directory-module">
	<section class="post-directory">
		<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#扯淡-我们是认真的"><span class="toc-number">1.</span> <span class="toc-text">扯淡!我们是认真的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#简介"><span class="toc-number">2.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是spring-data"><span class="toc-number">3.</span> <span class="toc-text">什么是spring-data</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#什么是JPA"><span class="toc-number">4.</span> <span class="toc-text">什么是JPA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何使用JPA"><span class="toc-number">5.</span> <span class="toc-text">如何使用JPA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#项目结构"><span class="toc-number">6.</span> <span class="toc-text">项目结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#相关配置"><span class="toc-number">7.</span> <span class="toc-text">相关配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#偶遇问题"><span class="toc-number">8.</span> <span class="toc-text">偶遇问题</span></a></li></ol>
	</section>
</div>
            
        </div>
    </div>
</section>

<footer class="container">
    <div class="site-footer" role="contentinfo">
        <div class="copyright left mobile-block">
                © 2020
                <span title="sunyuanhang">sunyuanhang</span>
                <a href="javascript:window.scrollTo(0,0)" target="_blank" rel="noopener" class="right mobile-visible">去顶部</a>
        </div>

        <ul class="site-footer-links right mobile-hidden">
            <li>
                <a href="javascript:window.scrollTo(0,0)" target="_blank" rel="noopener" >去顶部</a>
            </li>
        </ul>

        <a href="https://github.com/yumemor/hexo-theme-primer" target="_blank" aria-label="view source code">
            <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
        </a>

        <ul class="site-footer-links mobile-hidden">
            
                  
                  <li>
                    <a href="/"  title="Home">Home</a>
                  </li>
            
                  
                  <li>
                    <a href="/categories/"  title="Archives">Archives</a>
                  </li>
            
                  
                  <li>
                    <a href="/open-source/"  title="仓库">仓库</a>
                  </li>
            
                  
                  <li>
                    <a href="/about/"  title="About">About</a>
                  </li>
            
            <li>
                <a href="/atom.xml">
                    <span class="octicon octicon-rss" style="color:orange;"></span>
                </a>
            </li>
        </ul>
    </div>
</footer>

		<script src="/js/geopattern.js"></script>
		<script src="/js/highlight.pack.js"></script>
		<script src="/lib/fancybox/jquery.fancybox-1.3.4.pack.js"></script>

		
			<script src="/js/toc.js"></script>
		

		<script src="/js/index.js"></script>

		 <script src="/js/popular_repo.js"></script> 

	</body>
</html>